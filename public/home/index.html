<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì‹¬ë§ˆì¼“ â€“ AI ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ ë§ˆì¼“ í™ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      background: #f3f4f6;
      color: #111827;
      padding: 16px 10px 40px;
    }
    .layout {
      max-width: 1080px;
      margin: 0 auto;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .brand-logo {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: radial-gradient(circle at 20% 0%, #fb7185, #f97316 40%, #6366f1 80%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
      font-weight: 900;
      box-shadow: 0 10px 24px rgba(248, 113, 113, 0.5);
    }
    .brand-text-main {
      font-size: 18px;
      font-weight: 800;
    }
    .brand-text-sub {
      font-size: 11px;
      color: #9ca3af;
    }
    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .chip {
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: white;
      color: #4b5563;
      text-decoration: none;
    }
    .chip.primary {
      background: #111827;
      color: white;
      border-color: transparent;
    }

    /* Hero & slider */
    .hero {
      position: relative;
      overflow: hidden;
      border-radius: 20px;
      padding: 20px 18px;
      margin-bottom: 20px;
      background: radial-gradient(circle at 0% 0%, #4f46e5, #0f172a 50%, #111827 100%);
      color: #e5e7eb;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.5);
    }
    .hero-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 12px;
    }
    .hero-title {
      font-size: 19px;
      font-weight: 800;
      line-height: 1.4;
    }
    .hero-subtext {
      margin-top: 6px;
      font-size: 12px;
      color: #cbd5f5;
    }
    .hero-meta {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 8px;
    }
    .hero-cta {
      font-size: 12px;
      padding: 7px 12px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #f97316, #fb7185);
      color: white;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 10px 24px rgba(249, 115, 22, 0.6);
    }
    .hero-pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 10px;
    }
    .hero-pill {
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .hero-slider {
      margin-top: 14px;
      background: rgba(15, 23, 42, 0.7);
      border-radius: 16px;
      padding: 12px 12px;
      overflow: hidden;
      position: relative;
    }
    .banner-title {
      font-size: 13px;
      font-weight: 700;
      color: #e5e7eb;
      margin-bottom: 4px;
    }
    .banner-sub {
      font-size: 11px;
      color: #9ca3af;
    }
    .banner-indicators {
      position: absolute;
      right: 10px;
      bottom: 8px;
      display: flex;
      gap: 4px;
    }
    .dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.4);
    }
    .dot.active {
      width: 10px;
      background: #f97316;
    }

    /* Category tabs */
    .category-tabs {
      margin: 20px 0 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 4px;
    }
    .category-tab {
      flex-shrink: 0;
      font-size: 12px;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      color: #4b5563;
      cursor: pointer;
      white-space: nowrap;
    }
    .category-tab.active {
      background: linear-gradient(135deg, #6366f1, #ec4899);
      border-color: transparent;
      color: white;
      box-shadow: 0 8px 22px rgba(99, 102, 241, 0.45);
    }

    /* Section titles */
    .section-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 12px 2px 6px;
    }
    .section-title {
      font-size: 15px;
      font-weight: 700;
    }
    .section-tag {
      font-size: 11px;
      color: #ef4444;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .section-sub {
      font-size: 11px;
      color: #9ca3af;
    }
    .link-small {
      font-size: 11px;
      color: #6b7280;
      cursor: default;
    }

    /* Cards grid */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
    }
    @media (max-width: 900px) {
      .cards-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
    @media (max-width: 640px) {
      body {
        padding: 16px 10px 28px;
      }
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .cards-grid {
        grid-template-columns: repeat(1, minmax(0, 1fr));
      }
      .hero {
        padding: 16px 14px;
      }
    }

    .test-card {
      border-radius: 18px;
      background: #ffffff;
      border: 1px solid #e5e7eb;
      padding: 10px 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      cursor: pointer;
      text-align: left;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
      transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    }
    .test-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 14px 28px rgba(15, 23, 42, 0.18);
      border-color: #c4b5fd;
    }
    .test-thumb {
      position: relative;
      border-radius: 14px;
      overflow: hidden;
      height: 110px;
      margin-bottom: 4px;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #111827;
      font-size: 30px;
    }
    .test-thumb-label {
      position: absolute;
      left: 8px;
      top: 8px;
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.78);
      color: #f9fafb;
    }
    .test-thumb-chip {
      position: absolute;
      right: 8px;
      bottom: 8px;
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(248, 250, 252, 0.9);
      color: #111827;
    }

    .test-title {
      font-size: 14px;
      font-weight: 700;
    }
    .test-desc {
      font-size: 11px;
      color: #6b7280;
      min-height: 32px;
    }
    .test-meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
    }
    .test-meta-left {
      font-size: 10px;
      color: #9ca3af;
    }
    .test-meta-right {
      font-size: 10px;
      color: #4b5563;
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .hot-badge {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(248, 113, 113, 0.12);
      color: #b91c1c;
    }

    .empty-state {
      font-size: 12px;
      color: #9ca3af;
      padding: 16px 6px;
    }
  </style>
</head>
<body>
  <div class="layout">
    <header>
      <div class="brand">
        <div class="brand-logo">ì‹¬</div>
        <div>
          <div class="brand-text-main">ì‹¬ë§ˆì¼“</div>
          <div class="brand-text-sub">ì˜¤ëŠ˜ ê¸°ë¶„ì— ë§ëŠ” ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ë¥¼ ê³¨ë¼ë³´ì„¸ìš”</div>
        </div>
      </div>
      <div class="header-actions">
        <a href="/admin" class="chip">ê´€ë¦¬ì í˜ì´ì§€</a>
        <a href="/admin" class="chip primary">AI ìë™ ìƒì„±ê¸°</a>
      </div>
    </header>

    <!-- Hero + ë°°ë„ˆ ìŠ¬ë¼ì´ë” -->
    <section class="hero">
      <div class="hero-top">
        <div>
          <div class="hero-title">
            ì˜¤ëŠ˜ ë°¤, ì–´ë–¤ í…ŒìŠ¤íŠ¸ë¡œ ë†€ì•„ë³¼ê¹Œìš”?<br />
            ì—°ì•  ì˜¨ë„, TMI ì„±ê²©, ê¸ˆì „ ê°ê°ê¹Œì§€ í•œ ë²ˆì—!
          </div>
          <div class="hero-subtext">
            ë²„íŠ¼ í•œ ë²ˆì´ë©´ í…ŒìŠ¤íŠ¸ê°€ ì™„ì„±ë˜ëŠ” AI ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ ë§ˆì¼“, <b>ì‹¬ë§ˆì¼“</b>ì…ë‹ˆë‹¤.
          </div>
          <div class="hero-meta">
            ì˜¤ëŠ˜ ì—…ë°ì´íŠ¸ëœ í…ŒìŠ¤íŠ¸ <span id="statNew">0</span> Â· ì „ì²´ ë“±ë¡ í…ŒìŠ¤íŠ¸ <span id="statTotal">0</span>
          </div>
          <button class="hero-cta" onclick="location.href='/admin'">
            AIë¡œ ìƒˆ í…ŒìŠ¤íŠ¸ ë§Œë“¤ê¸°
          </button>
        </div>
      </div>

      <div class="hero-pill-row">
        <div class="hero-pill">#ì—°ì• _ì¸íƒ€ëŠ”ì¤‘</div>
        <div class="hero-pill">#TMI_ì„±ê²©íŒŒí—¤ì¹˜ê¸°</div>
        <div class="hero-pill">#ê¸ˆì „ê°ê°_ì²´í¬</div>
        <div class="hero-pill">#ì§ì¥_í”„ë¡œë¶ˆí¸ëŸ¬_í…ŒìŠ¤íŠ¸</div>
        <div class="hero-pill">#ìš°ì •í…œ_ëª¨ì„ì—ì„œ_ëŒë ¤ë³´ê¸°</div>
      </div>

      <div class="hero-slider" id="bannerSlider">
        <div id="bannerContent">
          <div class="banner-title">ì‹¬ë§ˆì¼“ì— ì˜¤ì‹  ê±¸ í™˜ì˜í•©ë‹ˆë‹¤ ğŸ‰</div>
          <div class="banner-sub">ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ë°°ë„ˆë¥¼ ë“±ë¡í•˜ë©´ ì´ ì˜ì—­ì— ìë™ìœ¼ë¡œ ë…¸ì¶œë©ë‹ˆë‹¤.</div>
        </div>
        <div class="banner-indicators" id="bannerDots"></div>
      </div>
    </section>

    <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
    <section>
      <div class="category-tabs" id="categoryTabs">
        <button class="category-tab active" data-key="all">ì „ì²´</button>
        <button class="category-tab" data-key="ì—°ì• ">ì—°ì• /MBTI ê°ì •</button>
        <button class="category-tab" data-key="ì„±ê²©">ì„±ê²©/MBTI ìœ í˜•</button>
        <button class="category-tab" data-key="ê¸ˆì „">ê¸ˆì „/ì†Œë¹„ ì„±í–¥</button>
        <button class="category-tab" data-key="ì§ì¥">ì§ì¥/ì»¤ë¦¬ì–´</button>
        <button class="category-tab" data-key="ìš°ì •">ìš°ì •/ëŒ€ì¸ê´€ê³„</button>
        <button class="category-tab" data-key="ë¼ì´í”„">ë¼ì´í”„ìŠ¤íƒ€ì¼</button>
      </div>
    </section>

    <!-- ì¸ê¸° TOP -->
    <section>
      <div class="section-title-row">
        <div>
          <div class="section-title">
            ì§€ê¸ˆ ëœ¨ëŠ” ì¸ê¸° TOP
            <span class="section-tag">HOT ğŸ”¥</span>
          </div>
          <div class="section-sub">ìµœê·¼ ì¼ì£¼ì¼ ë™ì•ˆ ì°¸ì—¬ ìˆ˜ê°€ ë§ì€ í…ŒìŠ¤íŠ¸</div>
        </div>
        <div class="link-small">ì‹¤ì‹œê°„ ìˆœìœ„ëŠ” ì¡°íšŒìˆ˜ ê¸°ë°˜ìœ¼ë¡œ ì •ë ¬ë©ë‹ˆë‹¤</div>
      </div>
      <div id="popularList" class="cards-grid"></div>
      <div id="popularEmpty" class="empty-state" style="display:none;">
        ì•„ì§ ì¸ê¸° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ë¥¼ ë” ë“±ë¡í•˜ê³ , ì§ì ‘ í”Œë ˆì´í•´ ë³´ì„¸ìš”.
      </div>
    </section>

    <!-- ë”°ëˆë”°ëˆ ìµœì‹  -->
    <section style="margin-top:18px;">
      <div class="section-title-row">
        <div>
          <div class="section-title">
            ë”°ëˆë”°ëˆ ìµœì‹  í…ŒìŠ¤íŠ¸ âœ¨
          </div>
          <div class="section-sub">ë°©ê¸ˆ ë§‰ ë“±ë¡ëœ í…ŒìŠ¤íŠ¸ë¶€í„° ì°¨ë¡€ëŒ€ë¡œ</div>
        </div>
        <div class="link-small">ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ë“±ë¡í•˜ë©´ ì¦‰ì‹œ ì´ê³³ì— ë…¸ì¶œë©ë‹ˆë‹¤</div>
      </div>
      <div id="latestList" class="cards-grid"></div>
      <div id="latestEmpty" class="empty-state" style="display:none;">
        ì•„ì§ ë“±ë¡ëœ í…ŒìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. AI ìë™ ìƒì„±ê¸°ë¡œ ì²« í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ì–´ ë³´ì„¸ìš”.
      </div>
    </section>
  </div>

  <script>
    let allTests = [];
    let selectedCategoryKey = 'all';

    // ---------- ê³µí†µ ìœ í‹¸ ----------
    function formatDate(iso) {
      if (!iso) return '';
      const d = new Date(iso);
      if (Number.isNaN(d.getTime())) return '';
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const dd = String(d.getDate()).padStart(2, '0');
      return `${mm}.${dd}`;
    }

    function matchCategory(test, key) {
      if (key === 'all') return true;
      const c = (test.category || '').toString();
      return c.includes(key);
    }

    function getEmojiByCategory(test) {
      const c = (test.category || '').toString();
      if (c.includes('ì—°ì• ')) return 'ğŸ’•';
      if (c.includes('ì„±ê²©') || c.includes('MBTI')) return 'ğŸ§ ';
      if (c.includes('ê¸ˆì „') || c.includes('ì†Œë¹„')) return 'ğŸ’°';
      if (c.includes('ì§ì¥') || c.includes('ì»¤ë¦¬ì–´')) return 'ğŸ’¼';
      if (c.includes('ìš°ì •') || c.includes('ëŒ€ì¸')) return 'ğŸ¤';
      if (c.includes('ë¼ì´í”„')) return 'ğŸŒˆ';
      return 'âœ¨';
    }

    function cardThumbnailStyle(test) {
      if (test.image) {
        return `background-image:url('${test.image}')`;
      }
      const gradient = 'linear-gradient(135deg,#e0f2fe,#f5d0fe)';
      return `background-image:${gradient}`;
    }

    function goPlay(test) {
      if (!test || !test.id) return;
      location.href = `/index.html?testId=${encodeURIComponent(test.id)}`;
    }

    // ---------- ì¹´í…Œê³ ë¦¬ íƒ­ ----------
    const categoryTabs = document.getElementById('categoryTabs');
    categoryTabs.querySelectorAll('.category-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        categoryTabs.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        selectedCategoryKey = tab.dataset.key;
        renderSections();
      });
    });

    // ---------- ë©”ì¸ ë°ì´í„° ë¡œë“œ ----------
    async function loadData() {
      try {
        const [testsRes, bannersRes] = await Promise.all([
          fetch('/api/tests'),
          fetch('/api/banners')
        ]);

        if (testsRes.ok) {
          allTests = await testsRes.json();
        } else {
          allTests = [];
        }

        const today = new Date();
        const todayStr = today.toISOString().slice(0, 10);

        // í†µê³„
        document.getElementById('statTotal').textContent = allTests.length;
        const todays = allTests.filter(t => (t.createdAt || '').slice(0, 10) === todayStr);
        document.getElementById('statNew').textContent = todays.length;

        renderSections();

        // ë°°ë„ˆ
        if (bannersRes.ok) {
          const banners = await bannersRes.json();
          initBannerSlider(banners.filter(b => b.isActive));
        } else {
          initBannerSlider([]);
        }
      } catch (e) {
        console.error('loadData error', e);
        allTests = [];
        renderSections();
        initBannerSlider([]);
      }
    }

    function renderSections() {
      renderPopular();
      renderLatest();
    }

    // ---------- ì¸ê¸° TOP ----------
    function renderPopular() {
      const wrap = document.getElementById('popularList');
      const empty = document.getElementById('popularEmpty');
      wrap.innerHTML = '';

      const filtered = allTests.filter(t => matchCategory(t, selectedCategoryKey));
      if (!filtered.length) {
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      // views desc, createdAt desc
      const sorted = [...filtered].sort((a, b) => {
        const vA = a.views || 0;
        const vB = b.views || 0;
        if (vB !== vA) return vB - vA;
        const dA = new Date(a.createdAt || 0).getTime();
        const dB = new Date(b.createdAt || 0).getTime();
        return dB - dA;
      });

      const top = sorted.slice(0, 6);
      for (const t of top) {
        const card = document.createElement('button');
        card.type = 'button';
        card.className = 'test-card';
        card.innerHTML = `
          <div class="test-thumb" style="${cardThumbnailStyle(t)}">
            <span class="test-thumb-label">${t.category || 'ì‹¬ë¦¬í…ŒìŠ¤íŠ¸'}</span>
            <span class="test-thumb-chip">ì°¸ì—¬ ${t.views || 0}íšŒ</span>
            <span>${getEmojiByCategory(t)}</span>
          </div>
          <div class="test-title">${t.title || 'ì œëª© ì—†ëŠ” í…ŒìŠ¤íŠ¸'}</div>
          <div class="test-desc">${t.description || 'í´ë¦­í•´ì„œ ë°”ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•´ ë³´ì„¸ìš”.'}</div>
          <div class="test-meta-row">
            <div class="test-meta-left">${formatDate(t.createdAt)} Â· ${t.tag || 'ì—”í„°í…Œì¸ë¨¼íŠ¸'}</div>
            <div class="test-meta-right">
              ${t.isHot ? '<span class="hot-badge">HOT</span>' : ''}
              <span>ì¡°íšŒ ${t.views || 0}</span>
            </div>
          </div>
        `;
        card.addEventListener('click', () => goPlay(t));
        wrap.appendChild(card);
      }
    }

    // ---------- ìµœì‹  í…ŒìŠ¤íŠ¸ ----------
    function renderLatest() {
      const wrap = document.getElementById('latestList');
      const empty = document.getElementById('latestEmpty');
      wrap.innerHTML = '';

      const filtered = allTests.filter(t => matchCategory(t, selectedCategoryKey));
      if (!filtered.length) {
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      const sorted = [...filtered].sort((a, b) => {
        const dA = new Date(a.createdAt || 0).getTime();
        const dB = new Date(b.createdAt || 0).getTime();
        return dB - dA;
      });

      const top = sorted.slice(0, 6);
      for (const t of top) {
        const card = document.createElement('button');
        card.type = 'button';
        card.className = 'test-card';
        card.innerHTML = `
          <div class="test-thumb" style="${cardThumbnailStyle(t)}">
            <span class="test-thumb-label">${t.category || 'ì‹¬ë¦¬í…ŒìŠ¤íŠ¸'}</span>
            ${t.isHot ? '<span class="test-thumb-chip">HOT</span>' : ''}
            <span>${getEmojiByCategory(t)}</span>
          </div>
          <div class="test-title">${t.title || 'ì œëª© ì—†ëŠ” í…ŒìŠ¤íŠ¸'}</div>
          <div class="test-desc">${t.description || 'ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ëŒë ¤ë³´ë©´ ë” ì¬ë°ŒëŠ” í…ŒìŠ¤íŠ¸!'}</div>
          <div class="test-meta-row">
            <div class="test-meta-left">${formatDate(t.createdAt)} Â· ${t.tag || 'ì—”í„°í…Œì¸ë¨¼íŠ¸'}</div>
            <div class="test-meta-right">
              <span>ì¡°íšŒ ${t.views || 0}</span>
            </div>
          </div>
        `;
        card.addEventListener('click', () => goPlay(t));
        wrap.appendChild(card);
      }
    }

    // ---------- ë°°ë„ˆ ìŠ¬ë¼ì´ë” ----------
    let bannerIndex = 0;
    let bannerTimer = null;

    function initBannerSlider(banners) {
      const content = document.getElementById('bannerContent');
      const dotsWrap = document.getElementById('bannerDots');
      if (!banners.length) {
        dotsWrap.innerHTML = '';
        return;
      }

      function renderBanner() {
        const b = banners[bannerIndex];
        content.innerHTML = `
          <div class="banner-title">${b.title}</div>
          <div class="banner-sub">${b.subtitle || ''}</div>
        `;
        if (b.link) {
          content.style.cursor = 'pointer';
          content.onclick = () => {
            if (b.link.startsWith('http')) {
              window.open(b.link, '_blank');
            } else {
              location.href = b.link;
            }
          };
        } else {
          content.style.cursor = 'default';
          content.onclick = null;
        }

        dotsWrap.innerHTML = '';
        banners.forEach((_, idx) => {
          const dot = document.createElement('div');
          dot.className = 'dot' + (idx === bannerIndex ? ' active' : '');
          dotsWrap.appendChild(dot);
        });
      }

      renderBanner();

      if (bannerTimer) clearInterval(bannerTimer);
      bannerTimer = setInterval(() => {
        bannerIndex = (bannerIndex + 1) % banners.length;
        renderBanner();
      }, 6000);
    }

    // ì´ˆê¸° ë¡œë“œ
    loadData();
  </script>
</body>
</html>
